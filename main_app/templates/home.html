{% load static %}
<html>
    <head>
      
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <title>Interview preparation</title>
        <link href="{% static 'css/home.css' %}" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <style>
          .intro
     {
    height:25vh;
    width: 100%;
    justify-content: center;
    align-items: center;
    display: flex;
    text-align: center;
    margin-bottom: 20px;
    background-image:url("{% static 'img/bg6.jpg' %}");
    background-position:center;
    background-repeat: no-repeat;
    background-size: 100%;

     }
        </style>
    </head>
    <body>
      <header>
        <!--nav-->
        <div class="navbr" style="padding-right:10%;">
          <nav class="navbar navbar-expand-lg bg-body-tertiary w-100" style="margin: 0;">
            <div class="container-fluid">
              <a class="navbar-brand" href="{% url 'home' %}"><img src="{% static 'img/LOGO (2).png' %}" style="height: 40px; width:40px;"><span style="color: blue;">Interview Preparation</span></a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <!--about,summery etc-->
              <div class="collapse navbar-collapse bg-body-tertiary" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                  <li class="nav-item" >
                    <a class="nav-link" aria-current="page" href="#ABOUT" >About</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#cont" >Contact Us</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'summary' %}" id="summary">Summary</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'log_reg' %}" id="login">Login</a>
                    <a class="nav-link" href="{% url 'logout_view' %}" style="display: none;" name="log_out" id="logout">Log out</a>
                  </li>
              </div>
            </div>
          </nav>
        </div>
        <div class="intro">
          <div id="carouselExampleSlidesOnly" class="carousel slide w-100" data-bs-ride="carousel">
            <div class="carousel-inner" >
              <div class="carousel-item active">
                <h2>WELCOME,LETS START PREPARING FOR INTERVIEW</h2>
              </div>
              <div class="carousel-item">
                <h2>Step 1:Choose your job-feild/Upload Resume</h2>
              </div>
              <div class="carousel-item">
                <h2>Step 2:Click Start</h2>
              </div>
              <div class="carousel-item">
                <h2>Step 3:Type answere to questions and click Submit</h2>
              </div>
              <div class="carousel-item">
                <h2>Step 4:Read Feedback and Suggested Answere and click next</h2>
              </div>
            </div>
          </div>
        </div>
      </header>
        <div class="field" id="field">
          <div class="field_heading">
          <h4><strong>
           <span style="color: red;">*</span>SELECT YOUR FIELD
          </strong></h4>
          </div>
 <form action="{% url 'home' %}" method="POST" id="job_detail_form">
            {% csrf_token %}
            <div class="field_btn">
              {{ Job_details.domain }}
            </div>
          </div>
          <hr id="hr" style="justify-content: center;display:flex;align-items: center; margin-right: 200px;margin-left:200px;color:blue; border-width: 2px;box-shadow: 0px 10px 15px rgba(7, 1, 23, 0.5);">
          <div class="discription" id="discription">
            <div class="des">
            <h5> job description :<br></h5>
            <!-- <textarea class="job-description" placeholder="your job description" ></textarea> -->
             {{ Job_details.description }}
            </div>
          </div>
          <!-- <div class="resume_area" id="resume_area">
            <div class="resume_heading">
              <h5>Upload your resume</h5>
            </div>
          <div class="resume_file">
            <div class="res">
            <input type="file" class="resume" id="resume" >
            <div class="res_sub" style="width: 100%; justify-content: flex-end; display: flex; flex-direction: column; ">
              <button type="submit" class="btn-res-sub" id="btn-res-sub"  style="color:white;background-color: rgb(70, 70, 225);">UPLOAD</button>
            </div>
          </div>
          </div>
            </div> -->
          <div class="start-btn">
           <button type="submit" name="action" value="Generate_question" id="button" >Generate Question</button>
          </div>
      
 </form> 
      <!--area in which quesrion,feedback and sugested ans is shown this area appears only if btn-generate question is clicked-->
     <section id="area"><!--section of area-->
        <div class="main_area" id="main_area"style="display: none;">
          <div class="stop_btn" style="width: 900px;">
          <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop" style="margin-bottom: 10px;margin-left: 700px;">
            End practicing
          </button>
          </div>
          <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
          <div class="modal-dialog">
          <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
              <div class="modal-header" style="background-color: rgb(111, 111, 250);color: white;">
                <h1 class="modal-title fs-5" id="staticBackdropLabel">Summary</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <!--question-->
                <strong id="q-1"></strong><br><br>
                <!--heading:feedback-->
                <strong id="f-1"></strong><br><br>
                <!--text-feedback-->
                <p id="t-1"></p><br><br>
                <hr>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="end_practice" onclick="practice_done()" >Ok</button>
              </div>
            </div>
          </div>
          </div>
          </div>
          <form  method="POST" id="ans_form">
            {% csrf_token %}
          <div class="card" style="width: 70rem;border :2px solid green">
            <strong class="card-header" style="background-color: rgba(67, 97, 219, 0.454);">Question</strong>
            <div class="card-body">
              <div class="text-center" id="loading_qn" style="display: none;">
                <div class="spinner-grw" >
                <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                <span role="status">Loading...</span>
                </div>
              </div>
              <strong class="quesrion" id="qn">{{ question }}</strong>
              <div class="card-body">
              <!--
                <div class="audioopt">
                  <form actin="">
                <input type="file" id="audio-upload" name="audio-upload" accept="audio/*" style=" display: none;">
                </div>
              -->
              <div class="typeans">
                 <!-- <textarea class="answeretypeopt" placeholder="Enter your Answere" id="textarea" ></textarea> -->{{ AnsForm.user_ans }}
              </div>
              <p class="text-danger" id="erroranswer" style="display: none;">please enter your message</p>
              <div class="ans">
                <input type="hidden" name="practice_id" id="practice_id" value="{{ practice_id }}">
              </div>
              <!--ans input method choose-->
              <div class="ans_method" style="display: flex; align-items: center; justify-content: center;"> 
               <!-- <a href="javascript:void(0);" onclick="showAudio()" style="margin-right: 30px;">Audio answer</a>--><a href="javascript:void(0);" onclick="showTextarea()">Text answer</a>
               </div>
              </div>
              <!--card footer btn-->
              <div class="card-footer" style="justify-content: space-between;width:100%">
                <button type="button" class="feedback" onclick="feedback()" >Feedback</button>
                <button type="submit" class="suggrstedans" name="action" value="suggested_answer" id="suggested_answer">Suggested Answere</button><!--onclick="answer()"-->
              </div>
            </div>
          </div>
           <!--feedback card-->
          <div class="card" style="width: 70rem; display: none; " id="feedback-card" >
              <strong class="card-header" style=" background-color: rgba(97, 204, 240, 0.514);">Feedback</strong>
              <div class="Feedback">
              <div class="card-body">
               <strong class="feedback" id="feedback">{{ feedback }}</strong>
              </div>
             </div>
          </div>
          <!--answere card-->
          <div class="card" style="width: 70rem; display: none;" id="answer-card">
            <strong class="card-header" style=" background-color: rgba(97, 204, 240, 0.413);">Suggested Answere</strong>
            <div class="card-body">
              <p class="card-text"><strong id="Suggested_ans">{{ Suggested_ans }}.</strong></p>
            </div>
          </div>
          <!--ans submit button and next question button-->
          <div class="ans_submit" style="margin-top:30px;margin-bottom: 30px;  ">
            
            <button type="submit" name="action" value="submit_for_AI" class="sub_btn_ans" id="sub" style="padding: 10px;color:white;background-color: rgba(69, 69, 238, 0.616); margin-left: 40%; " >Submit for AI Feedback</button> <!---onclick="feedback_ans()"-->
            <button type="submit" name="action" value="next_qn" class="sub_btn_ans" id="next_one" style="padding: 10px;color:white;background-color: rgba(69, 69, 238, 0.616); display: none;margin-left: 40%; ">Next Question</button><!---onclick="next_ans()"-->
            
          </div>
          </form>
          </div>
     </section>
      <script src="{% static 'js/home.js' %}"></script>
   
      <!-- </div>-->
    
    <div class="container" id="container">
      <section id="ABOUT">
      <div class="About" style="padding:100px">
        <div style="text-align:center;">
          <h2 style="text-decoration:underline; color:blue">ABOUT</h2>
          <p>Are you preparing for a job interview and want to ensure you're fully ready? Our website offers an innovative AI-powered interview preparation platform. With our service, you can practice real interview questions tailored to your desired job role, receive instant feedback, and improve your interview skills.
           <br>
            Our AI interview coach simulates real interview scenarios, providing personalized questions based on your resume and job description. You'll get actionable feedback on your answers, helping you refine your responses and boost your confidence.
            <br>
            Whether you're a recent graduate or a seasoned professional, our platform is designed to help you excel in your interviews and land your dream job. Start practicing today and take the first step towards a successful career!</p>
        </div>
      </div>
    </section>
    <div class="modal fade" id="messagemodel" tabindex="-1" aria-labellby="modalheading" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="modalheading">NOTIFFICATION</h4>
          </div>
          <div class="modal-body">
            {% if messages %}
             {% for message in messages %}
               <p style="color:red">{{ message }}</p>
              {% endfor %}
            {% endif %}
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-secondary" data-bs-dismiss="modal">cloose</button>
          </div>
        </div>
      </div>
    </div>
    <div id="message-flag" data-has-messages="{% if messages %}true{% else %}false{% endif %}" hidden></div>
    <script>
      document.addEventListener("DOMContentLoaded",function(){
         var messageflag=document.getElementById('message-flag').getAttribute("data-has-messages");
        if(messageflag=="true"){
           var messagemodal=new bootstrap.Modal(document.getElementById("messagemodel"))
           messagemodal.show();
         }
      });
    </script>
     <section id="cont">
        <div class="contact">
          <!-- {% if messages %}
             {% for message in messages %}
               {{ message }}
              {% endfor %}
          {% endif %} -->
          <div style="text-align:center">
            <h2 style="color:blue;text-decoration: underline;">Contact Us</h2>
            <p>Any doubt,Feel free to Contact Us</p>
          </div>
          <div class="row">
            <div class="column">
              <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3934.326629766461!2d76.58663417483986!3d9.567086390517378!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3b062c368046b521%3A0xa26ec01c48ef7f72!2sIHRD%20CoAS(College%20of%20Applied%20Science)Payyappady%2C%20Puthuppally!5e0!3m2!1sen!2sin!4v1737694184487!5m2!1sen!2sin" width="600" height="450" style="border:2px solid blue;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
            <div class="column">
              <form action="{% url 'contact_us' %}" method="POST" id="cont_form">
                {% csrf_token %}
                <div class="firname">
                  <label for="fname">First Name</label>
                  <input type="text" id="fname" name="firstname" placeholder="Your name..">
                   <p class="text-danger" id="errorname">please enter firstname</p>
                </div>
                <div class="lasname">
                  <label for="lname">Last Name</label>
                  <input type="text" id="lname" name="lastname" placeholder="Your last name..">
                  <p class="text-danger" id="errorlastname">please enter lastname</p>
                </div>
               <div class="countryy">
                  <label for="country">Country</label>
                  <input type="text" id="lcountry" name="country" placeholder="Your Country">
                  <p class="text-danger" id="errorcountry">please enter country's name</p>
               </div>
                <div class="subjarea">
                  <label for="subject">Subject</label>
                  <textarea id="subject" name="subject" placeholder="Write something.." style="height:170px"></textarea>
                  <p class="text-danger" id="errorsubject">please enter your message</p>
                </div>
               <div class="contsubmit">
                 <input type="submit" value="Submit">
                </div>
              </form>
            </div>
          </div>
        </div>
      </section>
    </div>
    <footer>
      <div class="rights" style="height: 100px;width: 100%;padding-top: 20px;text-align: center;background-color: #f2f2f2;">
        <p>© AI POWERED JOB INTERVIEW PREPARATION SYSTEM , ALL RIGHTS RESERVED</p>
        <p>CONTACT US @: <a href="https://mail.google.com">aiinterview@gmail.com</a></p>
      </div>
    </footer>
    <script>
      //validation of contact form
      $(document).ready(function(){
        $("#errorname").hide();
        $("#fname").keyup(function(){
          validatefirstname()
        })
        function validatefirstname()
        {
          let firstname=$("#fname").val()
          if(!firstname)
        {
          $("#errorname").show();
          $("#errorname").html("please enter firstname");
          return false
        }
         else
         {
            let fnamepattern=/^[A-Za-z]+$/;
            let fnamepattervalid=fnamepattern.test(firstname)
            if(!fnamepattervalid)
          {
            $("#errorname").show();
            $("#errorname").html("please enter valid firstname");
            return false
          }
          else
          {
            $("#errorname").hide();
            return true
          }
        }
        }
        //validate lastname
        $("#errorlastname").hide();
        $("#lname").keyup(function(){
          validatelastname()
        })
        function validatelastname()
        {
          let lastname=$("#lname").val()
          if(!lastname)
        {
          $("#errorlastname").show();
          $("#errorlastname").html("please enter lastname");
          return false
        }
         else
         {
            let lnamepattern=/^[A-Za-z]+$/;
            let lnamepattervalid=lnamepattern.test(lastname)
            if(!lnamepattervalid)
          {
            $("#errorlastname").show();
            $("#errorlastname").html("please enter valid lasttname");
            return false
          }
          else
          {
            $("#errorlastname").hide();
            return true
          }
        }
        }
        //validate country
        $("#errorcountry").hide();
        $("#lcountry").keyup(function(){
          validatecountry()
        })
        function validatecountry()
        {
          let country=$("#lcountry").val()
          if(!country)
        {
          $("#errorcountry").show()
          $("#errorcountry").html("please enter country's name")
          return false
        }
        else
        {
          let countryPattern = /^[A-Za-z\s'-]+$/;
          let countrypat=countryPattern.test(country)
          if(!countrypat)
        {
          $("#errorcountry").show()
          $("#errorcountry").html("please enter a valid country name")
          return false
        }
        else
        {
          $("#errorcountry").hide();
          return true
        }
        }
        }
        $("#errorsubject").hide();
        $("#subject").keyup(function(){
          validatesuject()
        })
        function validatesuject()
        {
          let sub=$("#subject").val()
          if(!sub)
        {
          $("#errorsubject").show()
          $("#errorsubject").html("please enter your messages")
          return false
        }
        else
        {
          $("#errorsubject").hide()
          return true
        }
        }
        var logedin="{{ loged_in }}"
        
        $('#cont_form').submit(function(event){
          if(logedin==='True'){
           if(!validatefirstname() || !validatelastname() || !validatecountry() || !validatesuject()){
            event.preventDefault()
           }
          }
           else{
          window.location.href="{% url 'log_reg' %}"
        }
        });
      
      });
        var mising="{{ field_missing|default:''|escapejs}}"
        document.addEventListener("DOMContentLoaded",function()
      {
        if(mising==='missing'){
        document.getElementById("cont").scrollIntoView({
          behavior: "smooth" ,
        });
      }
      });
    </script>
    <script>
      document.querySelector('.nav-link[href="#About"]').addEventListener("click", function(event) {
          event.preventDefault(); // Prevent the default anchor click behavior
          // Scroll to the 'About' section smoothly
          document.getElementById("About").scrollIntoView({
              behavior: "smooth" 
          });
      });
      document.querySelector('.nav-link[href="#cont"]').addEventListener("click", function(event) {
          event.preventDefault(); // Prevent the default anchor click behavior
          // Scroll to the 'About' section smoothly
          document.getElementById("cont").scrollIntoView({
              behavior: "smooth" ,
          });
      });
      </script>
      <script>
        var endpractice = document.getElementById("end_practice");
        function practice_done() {
            window.location.href = "home.html";
        }
      </script>
      <script>
       var logedin="{{ loged_in }}"
       var logiin=document.getElementById("login");
       var logout=document.getElementById("logout");
       if(logedin='user')
       {
        logiin.style.display='none';
        logout.style.display='block';
       }
       else{
         logiin.style.display='block';
        logout.style.display='none';
    //     document.getElementById("summary").addEventListener('click', function(event) {
    //       event.preventDefault();
    //     window.location.href = "{% url 'log_reg' %}"; // Redirect to log_reg.html if not logged in
    // });
       }
       

      </script>
      <!-- to make job description come as we change the domain -->
      <script>
        const job_description=document.querySelector('.job_description')
        document.querySelector(".Job_title").addEventListener('change',function(){
          const job_title=this.value.trim()
          if(job_title)
        {
          fetch(`/get_job_description/?domain=${encodeURIComponent(job_title)}`)
          .then(response=>response.json())
          .then(data=>
            {
              job_description.value=data.job_description;
            }
          );
        }
        else{
          job_descriptin.value="";
        }
        })
      </script>
      <script>
        const generateQuestionUrl = "{% url 'generate_question' %}";
        const generateFeed_ans="{% url 'generateFeed_ans' %}";
        const AI_answer="{% url 'AI_answer' %}";
        const Next_question="{% url 'Next_question' %}";
var field = document.getElementById("field");
var discription=document.getElementById("discription");
// var resume_area=document.getElementById("resume_area");
var button=document.getElementById("button");
var main_area=document.getElementById("main_area");
var hr=document.getElementById("hr");
var ans_sub_but=document.getElementById("sub");
var next=document.getElementById("next_one");
var area=document.getElementById("area");
var loading_question=document.getElementById("loading_qn")
button.addEventListener('click',function(event){
    event.preventDefault()
    var question=document.getElementById('qn')
    var form=document.getElementById('job_detail_form')
    var formData = new FormData(form);
    var practice_id=document.getElementById('practice_id')
    loading_question.style.display="block"
    fetch(generateQuestionUrl, {
    method: "POST",
    body: formData,
    headers: {
        "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value
    }
})
.then(response => response.json())
    .then(data => {
        if (data.question) {
            question.innerText = data.question;  // ✅ Update question text
            question.style.display = "block"; 
            loading_question.style.display="none" // ✅ Show the question if it was hidden
        } 
        practice_id.value=data.practice_id;
    })
    field.style.display = "none";
    // resume_area.style.display = "none";
    discription.style.display = "none";
    button.style.display = "none";
    hr.style.display = "none";
    main_area.style.display = "flex";
    });

    // submit for AI feedbac and answer
    var feedbacke=document.getElementById("feedback-card");
    var answere=document.getElementById("answer-card");
    var feedback=document.getElementById('feedback');
    var suggested_answer=document.getElementById('Suggested_ans')
    document.getElementById('sub').addEventListener('click',function(event){
    event.preventDefault();
    var ansform=document.getElementById('ans_form')
    var ansform_data=new FormData(ansform);
    var userAns = ansform_data.get('user_ans');  // Get the value of user_ans field
    if (!userAns || userAns.trim() === "") 
    {
        document.getElementById('erroranswer').style.display="block";
        return;  
    }
    else{
    document.getElementById('erroranswer').style.display="none";
    fetch(generateFeed_ans,{
      method:"POST",
      body:ansform_data,
      headers:{
        "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value
      }
    })
    .then(response=>response.json())
    .then(data=>
    {
       feedback.innerText=data.feedback;
       suggested_answer.innerText=data.Suggested_ans;
    }
    );
  
    
    feedbacke.style.display = "flex";
    answere.style.display = "flex"; 
    ans_sub_but.style.display="none";
    next.style.display="block";
  }
    });

    // feedback card-btn
    // var feedbacke=document.getElementById("feedback-card");
    // var answere=document.getElementById("answer-card");
function feedback()
    { 
    if(feedbacke.style.display == "flex")
    {
        feedbacke.style.display = "none";
    }
    else{
        feedbacke.style.display = "flex";
        if(feedback.innerText=="")
        {
          feedback.innerText="Sorry,No Feedback available,Please submit your Answer";
        } 
    }
    }


    //  suggested answer 
    document.getElementById('suggested_answer').addEventListener('click',function(event){
      event.preventDefault();
      if(answere.style.display == "flex")
        {
            answere.style.display = "none";
            next.style.display="flex";
        }
        else{
            answere.style.display = "flex";
            next.style.display="none";
        }
      var ansform=document.getElementById('ans_form')
      var ansform_data=new FormData(ansform);
      fetch(AI_answer,{
        method:"POST",
        body:ansform_data,
        headers:{
          "X-CSRFToken":document.querySelector('[name=csrfmiddlewaretoken]').value
        } 
      })
      .then(response=>response.json())
      .then(data=>{
        suggested_answer.innerText=data.Suggested_ans;
      });
    }); 


    // next question
    document.getElementById('next_one').addEventListener('click',function(event){
    event.preventDefault();
    document.querySelector("user_ans").innerText="";
    var nextform=document.getElementById('ans_form')
    var nextform_data=new FormData(nextform);
    var question=document.getElementById('qn')
    var practice_id=document.getElementById('practice_id')
    fetch(Next_question,{
        method:"POST",
        body:nextform_data,
        headers:{
          "X-CSRFToken":document.querySelector('[name=csrfmiddlewaretoken]').value
        } 
      })
      .then(response=>response.json())
      .then(data => {
        if (data.question) {
            question.innerText = data.question;  // ✅ Update question text
            question.style.display = "block"; 
            loading_question.style.display="none" // ✅ Show the question if it was hidden
        } 
        practice_id.value=data.practice_id;
    });
    next.style.display="none";
    ans_sub_but.style.display="block";
    feedbacke.style.display = "none";
    answere.style.display = "none"; 
    area.scrollIntoView({
        behavior: "smooth",
        block: "center"
    });

    });
    </script>
    </body>
</html>